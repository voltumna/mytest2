<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" ============================================"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === ***  THIS POLICY IS READ ONLY ***"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === If you have the need to customize this policy"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === please contact CA APIM Support so we can improve customization capability"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" ============================================"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="This policy can be found and should be used as 'Encapsulated Assertion'!"/>
        </L7p:CommentAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="MDAw"/>
            <L7p:VariableToSet stringValue="error.code"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue=""/>
            <L7p:VariableToSet stringValue="result"/>
        </L7p:SetVariable>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${cacheKey}"/>
                    <L7p:Expression2 stringValue=""/>
                    <L7p:Negate booleanValue="true"/>
                    <L7p:Operator operator="EMPTY"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Negated booleanValue="true"/>
                            <L7p:Operator operator="EMPTY"/>
                            <L7p:RightValue stringValue=""/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="success"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="MTAz"/>
                    <L7p:VariableToSet stringValue="error.code"/>
                </L7p:SetVariable>
                <L7p:FalseAssertion/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="error"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="Verify required values"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${operation}"/>
                    <L7p:Expression2 stringValue="store"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="store"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="RXJyb3IgYWNjZXNzaW5nIHRoZSBzZXNzaW9uIHN0b3JlLg=="/>
                    <L7p:VariableToSet stringValue="result"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${value}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="MTAz"/>
                            <L7p:VariableToSet stringValue="error.code"/>
                        </L7p:SetVariable>
                        <L7p:FalseAssertion/>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="error"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="Verify required values"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheId}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ZGVmYXVsdENhY2hl"/>
                        <L7p:VariableToSet stringValue="cacheId"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheId"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheAge}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MzYwMDAw"/>
                        <L7p:VariableToSet stringValue="cacheAge"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheAge"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheMaxEntries}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MTA="/>
                        <L7p:VariableToSet stringValue="cacheMaxEntries"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheMaxEntries"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheMaxSize}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MTAwMDAw"/>
                        <L7p:VariableToSet stringValue="cacheMaxSize"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheMaxSize"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${dbAge}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtjYWNoZUFnZX0="/>
                        <L7p:VariableToSet stringValue="dbAge"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine dbAge"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue=""/>
                    <L7p:DataType variableDataType="dateTime"/>
                    <L7p:DateOffsetExpression stringValue="${dbAge}"/>
                    <L7p:VariableToSet stringValue="session_expiration"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:JdbcQuery>
                        <L7p:ConnectionName stringValue="OAuth"/>
                        <L7p:MaxRecords intValue="1"/>
                        <L7p:QueryName stringValue="Update existing session in DB"/>
                        <L7p:SqlQuery stringValueReference="inline"><![CDATA[UPDATE oauth_session
                SET expiration = ${session_expiration.seconds}, value = ${value}
                WHERE session_key = ${cacheKey}
                AND session_group = ${cacheId}]]></L7p:SqlQuery>
                        <L7p:VariablePrefix stringValue="sessionStore"/>
                    </L7p:JdbcQuery>
                    <L7p:JdbcQuery>
                        <L7p:ConnectionName stringValue="OAuth"/>
                        <L7p:QueryName stringValue="Insert or update session"/>
                        <L7p:SqlQuery stringValueReference="inline"><![CDATA[INSERT INTO oauth_session (session_key,session_group,expiration,value)
                VALUES (${cacheKey},${cacheId},${session_expiration.seconds},${value})]]></L7p:SqlQuery>
                        <L7p:VariablePrefix stringValue="sessionStore"/>
                    </L7p:JdbcQuery>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="Insert or Update"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHt2YWx1ZX0="/>
                    <L7p:ContentType stringValue="text/xml;charset=UTF-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="valueMessage"/>
                </L7p:SetVariable>
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="e5ee8bcf-1796-4297-88dd-c838031a6f6a"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="OTK Cache Store"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="cacheID"/>
                            <L7p:value stringValue="${cacheId}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="cacheKey"/>
                            <L7p:value stringValue="${cacheKey}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="doNotCacheSoapFaults"/>
                            <L7p:value stringValue="true"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="maxEntries"/>
                            <L7p:value stringValue="${cacheMaxEntries}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="maxEntryAge"/>
                            <L7p:value stringValue="${cacheAge}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="maxEntrySize"/>
                            <L7p:value stringValue="${cacheMaxSize}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="msg"/>
                            <L7p:value stringValue="valueMessage"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="S2V5ICR7Y2FjaGVLZXl9IGFkZGVkIHRvIHNlc3Npb24u"/>
                    <L7p:VariableToSet stringValue="result"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="dGV4dC9wbGFpbjtjaGFyc2V0PVVURi04"/>
                    <L7p:VariableToSet stringValue="content-type"/>
                </L7p:SetVariable>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="STORE"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${operation}"/>
                    <L7p:Expression2 stringValue="get"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="get"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="dGV4dC94bWw="/>
                    <L7p:VariableToSet stringValue="content-type"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheId}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ZGVmYXVsdENhY2hl"/>
                        <L7p:VariableToSet stringValue="cacheId"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheId"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheAge}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MzYwMDAw"/>
                        <L7p:VariableToSet stringValue="cacheAge"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheAge"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:ContentType stringValue="text/xml;charset=UTF-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="resp"/>
                        </L7p:SetVariable>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="68ad78a1-f4a1-4568-91e1-0980d95c75cd"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="OTK Cache Look Up"/>
                            <L7p:Parameters mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="cacheID"/>
                                    <L7p:value stringValue="${cacheId}"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="cacheKey"/>
                                    <L7p:value stringValue="${cacheKey}"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="maxAcceptableAge"/>
                                    <L7p:value stringValue="${cacheAge}"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="maxEntryAge"/>
                                    <L7p:value stringValue="${cacheAge}"/>
                                </L7p:entry>
                            </L7p:Parameters>
                        </L7p:Encapsulated>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="resp.mainpart"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="encoded"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="PGZvdW5kIHhtbG5zPSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEyLzExL290ay1zZXNzaW9uIj4NCiAgPHZhbHVlPiR7ZW5jb2RlZH08L3ZhbHVlPg0KICA8bG9jYXRpb24+Y2FjaGU8L2xvY2F0aW9uPg0KPC9mb3VuZD4="/>
                            <L7p:ContentType stringValue="text/xml;charset=UTF-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="resp"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Check cache"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:DataType variableDataType="dateTime"/>
                            <L7p:DateOffsetExpression stringValue=""/>
                            <L7p:VariableToSet stringValue="now"/>
                        </L7p:SetVariable>
                        <L7p:JdbcQuery>
                            <L7p:AssertionFailureEnabled booleanValue="false"/>
                            <L7p:ConnectionName stringValue="OAuth"/>
                            <L7p:NamingMap mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="value"/>
                                    <L7p:value stringValue="session_value"/>
                                </L7p:entry>
                            </L7p:NamingMap>
                            <L7p:QueryName stringValue="Retrieve from session"/>
                            <L7p:SqlQuery stringValueReference="inline"><![CDATA[SELECT value
                FROM oauth_session
                WHERE session_key=${cacheKey}
                AND session_group=${cacheId}
                AND ${now.seconds} < expiration]]></L7p:SqlQuery>
                            <L7p:VariablePrefix stringValue="sessionQuery"/>
                        </L7p:JdbcQuery>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${sessionQuery.queryresult.count}"/>
                                    <L7p:Expression2 stringValue="0"/>
                                    <L7p:Operator operator="GT"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:Operator operator="GT"/>
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:EncodeDecode>
                                    <L7p:SourceVariableName stringValue="sessionQuery.session_value"/>
                                    <L7p:TargetDataType variableDataType="string"/>
                                    <L7p:TargetVariableName stringValue="encoded"/>
                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                </L7p:EncodeDecode>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGZvdW5kIHhtbG5zPSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEyLzExL290ay1zZXNzaW9uIj4NCiAgPHZhbHVlPiR7ZW5jb2RlZH08L3ZhbHVlPg0KICA8bG9jYXRpb24+ZGF0YWJhc2U8L2xvY2F0aW9uPg0KPC9mb3VuZD4="/>
                                    <L7p:ContentType stringValue="text/xml;charset=UTF-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="resp"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// yes"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:SetVariable>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// no"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Base64Expression stringValue="PGZvdW5kIHhtbG5zPSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEyLzExL290ay1zZXNzaW9uIiAvPg=="/>
                                <L7p:ContentType stringValue="text/xml;charset=UTF-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="resp"/>
                            </L7p:SetVariable>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// anything available?"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Check database"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Find session value"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="GET"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:Expression1 stringValue="${operation}"/>
                    <L7p:Expression2 stringValue="delete"/>
                    <L7p:ExpressionIsVariable booleanValue="false"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="delete"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheId}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ZGVmYXVsdENhY2hl"/>
                        <L7p:VariableToSet stringValue="cacheId"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheId"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheAge}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MzYwMDAw"/>
                        <L7p:VariableToSet stringValue="cacheAge"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheAge"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheMaxEntries}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MTA="/>
                        <L7p:VariableToSet stringValue="cacheMaxEntries"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheMaxEntries"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:Expression1 stringValue="${cacheMaxSize}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="MTAwMDAw"/>
                        <L7p:VariableToSet stringValue="cacheMaxSize"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Determine cacheMaxSize"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="e5787b1a-e832-4cd9-9017-c7620e575b02"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="OTK Cache Remove"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="cacheID"/>
                            <L7p:value stringValue="${cacheId}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="cacheKey"/>
                            <L7p:value stringValue="${cacheKey}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="doNotCacheSoapFaults"/>
                            <L7p:value stringValue="true"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="maxEntries"/>
                            <L7p:value stringValue="${cacheMaxEntries}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="maxEntryAge"/>
                            <L7p:value stringValue="${cacheAge}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="maxEntrySize"/>
                            <L7p:value stringValue="${cacheMaxSize}"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:JdbcQuery>
                    <L7p:AssertionFailureEnabled booleanValue="false"/>
                    <L7p:ConnectionName stringValue="OAuth"/>
                    <L7p:MaxRecords intValue="1000"/>
                    <L7p:QueryName stringValue="Delete session"/>
                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[DELETE FROM oauth_session
                WHERE session_key = ${cacheKey}
                AND session_group = ${cacheId}]]></L7p:SqlQuery>
                    <L7p:VariablePrefix stringValue="deleteQuery"/>
                </L7p:JdbcQuery>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="U2Vzc2lvbiBkZWxldGVkLg=="/>
                    <L7p:VariableToSet stringValue="result"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="dGV4dC9wbGFpbjtjaGFyc2V0PVVURi04"/>
                    <L7p:VariableToSet stringValue="content-type"/>
                </L7p:SetVariable>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="DELETE"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${operation}"/>
                        <L7p:Expression2 stringValue="deleteExpired"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="deleteExpired"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue=""/>
                        <L7p:DataType variableDataType="dateTime"/>
                        <L7p:DateOffsetExpression stringValue=""/>
                        <L7p:VariableToSet stringValue="now"/>
                    </L7p:SetVariable>
                    <L7p:JdbcQuery>
                        <L7p:AssertionFailureEnabled booleanValue="false"/>
                        <L7p:ConnectionName stringValue="OAuth"/>
                        <L7p:MaxRecords intValue="1000"/>
                        <L7p:QueryName stringValue="Delete expired sessions"/>
                        <L7p:SqlQuery stringValueReference="inline"><![CDATA[DELETE FROM oauth_session
                WHERE expiration <= ${now.seconds}]]></L7p:SqlQuery>
                        <L7p:VariablePrefix stringValue="deleteExpired"/>
                    </L7p:JdbcQuery>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="${deleteExpired.queryresult.count} expired sessions deleted."/>
                    </L7p:AuditDetailAssertion>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="MySQL"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="DELETE_EXPIRED"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="MDAw"/>
                    <L7p:VariableToSet stringValue="error.code"/>
                </L7p:SetVariable>
                <L7p:FalseAssertion/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="error"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
        </wsp:OneOrMore>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue=""/>
            <L7p:VariableToSet stringValue="error.code"/>
        </L7p:SetVariable>
    </wsp:All>
</wsp:Policy>
